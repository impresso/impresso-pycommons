<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Data Versioning &mdash; Impresso PyCommons  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Image handling" href="images.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Impresso PyCommons
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="io.html">Input/Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="rebuild.html">Text Rebuild</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="images.html">Image handling</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Data Versioning</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#module-impresso_commons.versioning.data_statistics">Data Statistics and Newspaper Statistics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.data_statistics.DataStatistics"><code class="docutils literal notranslate"><span class="pre">DataStatistics</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.data_statistics.DataStatistics.stage"><code class="docutils literal notranslate"><span class="pre">DataStatistics.stage</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.data_statistics.DataStatistics.granularity"><code class="docutils literal notranslate"><span class="pre">DataStatistics.granularity</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.data_statistics.DataStatistics.element"><code class="docutils literal notranslate"><span class="pre">DataStatistics.element</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.data_statistics.DataStatistics.count_keys"><code class="docutils literal notranslate"><span class="pre">DataStatistics.count_keys</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.data_statistics.DataStatistics.counts"><code class="docutils literal notranslate"><span class="pre">DataStatistics.counts</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.data_statistics.DataStatistics.add_counts"><code class="docutils literal notranslate"><span class="pre">DataStatistics.add_counts()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.data_statistics.DataStatistics.init_counts"><code class="docutils literal notranslate"><span class="pre">DataStatistics.init_counts()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.data_statistics.DataStatistics.pretty_print"><code class="docutils literal notranslate"><span class="pre">DataStatistics.pretty_print()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.data_statistics.DataStatistics.same_counts"><code class="docutils literal notranslate"><span class="pre">DataStatistics.same_counts()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.data_statistics.NewspaperStatistics"><code class="docutils literal notranslate"><span class="pre">NewspaperStatistics</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.data_statistics.NewspaperStatistics.stage"><code class="docutils literal notranslate"><span class="pre">NewspaperStatistics.stage</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.data_statistics.NewspaperStatistics.granularity"><code class="docutils literal notranslate"><span class="pre">NewspaperStatistics.granularity</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.data_statistics.NewspaperStatistics.element"><code class="docutils literal notranslate"><span class="pre">NewspaperStatistics.element</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.data_statistics.NewspaperStatistics.count_keys"><code class="docutils literal notranslate"><span class="pre">NewspaperStatistics.count_keys</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.data_statistics.NewspaperStatistics.counts"><code class="docutils literal notranslate"><span class="pre">NewspaperStatistics.counts</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.data_statistics.NewspaperStatistics.possible_count_keys"><code class="docutils literal notranslate"><span class="pre">NewspaperStatistics.possible_count_keys</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.data_statistics.NewspaperStatistics.pretty_print"><code class="docutils literal notranslate"><span class="pre">NewspaperStatistics.pretty_print()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.data_statistics.NewspaperStatistics.same_counts"><code class="docutils literal notranslate"><span class="pre">NewspaperStatistics.same_counts()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#module-impresso_commons.versioning.data_manifest">Data Manifest</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.data_manifest.DataManifest"><code class="docutils literal notranslate"><span class="pre">DataManifest</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.data_manifest.DataManifest.add_by_ci_id"><code class="docutils literal notranslate"><span class="pre">DataManifest.add_by_ci_id()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.data_manifest.DataManifest.add_by_title_year"><code class="docutils literal notranslate"><span class="pre">DataManifest.add_by_title_year()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.data_manifest.DataManifest.add_count_list_by_title_year"><code class="docutils literal notranslate"><span class="pre">DataManifest.add_count_list_by_title_year()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.data_manifest.DataManifest.aggregate_stats_for_title"><code class="docutils literal notranslate"><span class="pre">DataManifest.aggregate_stats_for_title()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.data_manifest.DataManifest.append_to_notes"><code class="docutils literal notranslate"><span class="pre">DataManifest.append_to_notes()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.data_manifest.DataManifest.compute"><code class="docutils literal notranslate"><span class="pre">DataManifest.compute()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.data_manifest.DataManifest.define_update_info_for_title"><code class="docutils literal notranslate"><span class="pre">DataManifest.define_update_info_for_title()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.data_manifest.DataManifest.generate_media_dict"><code class="docutils literal notranslate"><span class="pre">DataManifest.generate_media_dict()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.data_manifest.DataManifest.get_count_keys"><code class="docutils literal notranslate"><span class="pre">DataManifest.get_count_keys()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.data_manifest.DataManifest.has_title_year_key"><code class="docutils literal notranslate"><span class="pre">DataManifest.has_title_year_key()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.data_manifest.DataManifest.init_yearly_count_dict"><code class="docutils literal notranslate"><span class="pre">DataManifest.init_yearly_count_dict()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.data_manifest.DataManifest.new_media"><code class="docutils literal notranslate"><span class="pre">DataManifest.new_media()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.data_manifest.DataManifest.output_mft_s3_path"><code class="docutils literal notranslate"><span class="pre">DataManifest.output_mft_s3_path</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.data_manifest.DataManifest.overall_stats"><code class="docutils literal notranslate"><span class="pre">DataManifest.overall_stats()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.data_manifest.DataManifest.replace_by_ci_id"><code class="docutils literal notranslate"><span class="pre">DataManifest.replace_by_ci_id()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.data_manifest.DataManifest.replace_by_title_year"><code class="docutils literal notranslate"><span class="pre">DataManifest.replace_by_title_year()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.data_manifest.DataManifest.title_level_stats"><code class="docutils literal notranslate"><span class="pre">DataManifest.title_level_stats()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.data_manifest.DataManifest.update_media_stats"><code class="docutils literal notranslate"><span class="pre">DataManifest.update_media_stats()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.data_manifest.DataManifest.validate_and_export_manifest"><code class="docutils literal notranslate"><span class="pre">DataManifest.validate_and_export_manifest()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#module-impresso_commons.versioning.helpers">Versioning Helpers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.helpers.DataStage"><code class="docutils literal notranslate"><span class="pre">DataStage</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.helpers.DataStage.CANONICAL"><code class="docutils literal notranslate"><span class="pre">DataStage.CANONICAL</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.helpers.DataStage.EMBEDDINGS"><code class="docutils literal notranslate"><span class="pre">DataStage.EMBEDDINGS</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.helpers.DataStage.ENTITIES"><code class="docutils literal notranslate"><span class="pre">DataStage.ENTITIES</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.helpers.DataStage.EVENIZED"><code class="docutils literal notranslate"><span class="pre">DataStage.EVENIZED</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.helpers.DataStage.LANGIDENT"><code class="docutils literal notranslate"><span class="pre">DataStage.LANGIDENT</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.helpers.DataStage.LINGUISTIC_PROCESSING"><code class="docutils literal notranslate"><span class="pre">DataStage.LINGUISTIC_PROCESSING</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.helpers.DataStage.MYSQL_CIS"><code class="docutils literal notranslate"><span class="pre">DataStage.MYSQL_CIS</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.helpers.DataStage.OCRQA"><code class="docutils literal notranslate"><span class="pre">DataStage.OCRQA</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.helpers.DataStage.PASSIM"><code class="docutils literal notranslate"><span class="pre">DataStage.PASSIM</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.helpers.DataStage.REBUILT"><code class="docutils literal notranslate"><span class="pre">DataStage.REBUILT</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.helpers.DataStage.SOLR_EMBS"><code class="docutils literal notranslate"><span class="pre">DataStage.SOLR_EMBS</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.helpers.DataStage.SOLR_ENTITIES"><code class="docutils literal notranslate"><span class="pre">DataStage.SOLR_ENTITIES</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.helpers.DataStage.SOLR_TEXT"><code class="docutils literal notranslate"><span class="pre">DataStage.SOLR_TEXT</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.helpers.DataStage.TEXT_REUSE"><code class="docutils literal notranslate"><span class="pre">DataStage.TEXT_REUSE</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.helpers.DataStage.TOPICS"><code class="docutils literal notranslate"><span class="pre">DataStage.TOPICS</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#impresso_commons.versioning.helpers.DataStage.has_value"><code class="docutils literal notranslate"><span class="pre">DataStage.has_value()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.helpers.agg"><code class="docutils literal notranslate"><span class="pre">agg()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.helpers.chunk"><code class="docutils literal notranslate"><span class="pre">chunk()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.helpers.clone_git_repo"><code class="docutils literal notranslate"><span class="pre">clone_git_repo()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.helpers.compute_stats_in_canonical_bag"><code class="docutils literal notranslate"><span class="pre">compute_stats_in_canonical_bag()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.helpers.compute_stats_in_entities_bag"><code class="docutils literal notranslate"><span class="pre">compute_stats_in_entities_bag()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.helpers.compute_stats_in_langident_bag"><code class="docutils literal notranslate"><span class="pre">compute_stats_in_langident_bag()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.helpers.compute_stats_in_rebuilt_bag"><code class="docutils literal notranslate"><span class="pre">compute_stats_in_rebuilt_bag()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.helpers.compute_stats_in_solr_text_bag"><code class="docutils literal notranslate"><span class="pre">compute_stats_in_solr_text_bag()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.helpers.counts_for_canonical_issue"><code class="docutils literal notranslate"><span class="pre">counts_for_canonical_issue()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.helpers.counts_for_rebuilt"><code class="docutils literal notranslate"><span class="pre">counts_for_rebuilt()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.helpers.extract_version"><code class="docutils literal notranslate"><span class="pre">extract_version()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.helpers.filter_new_or_modified_media"><code class="docutils literal notranslate"><span class="pre">filter_new_or_modified_media()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.helpers.finalize"><code class="docutils literal notranslate"><span class="pre">finalize()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.helpers.find_s3_data_manifest_path"><code class="docutils literal notranslate"><span class="pre">find_s3_data_manifest_path()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.helpers.get_head_commit_url"><code class="docutils literal notranslate"><span class="pre">get_head_commit_url()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.helpers.get_media_item_years"><code class="docutils literal notranslate"><span class="pre">get_media_item_years()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.helpers.get_media_titles"><code class="docutils literal notranslate"><span class="pre">get_media_titles()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.helpers.git_commit_push"><code class="docutils literal notranslate"><span class="pre">git_commit_push()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.helpers.increment_version"><code class="docutils literal notranslate"><span class="pre">increment_version()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.helpers.init_media_info"><code class="docutils literal notranslate"><span class="pre">init_media_info()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.helpers.is_git_repo"><code class="docutils literal notranslate"><span class="pre">is_git_repo()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.helpers.manifest_summary"><code class="docutils literal notranslate"><span class="pre">manifest_summary()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.helpers.media_list_from_mft_json"><code class="docutils literal notranslate"><span class="pre">media_list_from_mft_json()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.helpers.read_manifest_from_s3"><code class="docutils literal notranslate"><span class="pre">read_manifest_from_s3()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.helpers.read_manifest_from_s3_path"><code class="docutils literal notranslate"><span class="pre">read_manifest_from_s3_path()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.helpers.remove_media_in_manifest"><code class="docutils literal notranslate"><span class="pre">remove_media_in_manifest()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.helpers.validate_granularity"><code class="docutils literal notranslate"><span class="pre">validate_granularity()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.helpers.validate_stage"><code class="docutils literal notranslate"><span class="pre">validate_stage()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.helpers.validate_version"><code class="docutils literal notranslate"><span class="pre">validate_version()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.helpers.version_as_list"><code class="docutils literal notranslate"><span class="pre">version_as_list()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.helpers.write_and_push_to_git"><code class="docutils literal notranslate"><span class="pre">write_and_push_to_git()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.helpers.write_dump_to_fs"><code class="docutils literal notranslate"><span class="pre">write_dump_to_fs()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#module-impresso_commons.versioning.compute_manifest">Manifest Computing Script</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.compute_manifest.compute_stats_for_stage"><code class="docutils literal notranslate"><span class="pre">compute_stats_for_stage()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.compute_manifest.create_manifest"><code class="docutils literal notranslate"><span class="pre">create_manifest()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.compute_manifest.extract_np_key"><code class="docutils literal notranslate"><span class="pre">extract_np_key()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.compute_manifest.get_files_to_consider"><code class="docutils literal notranslate"><span class="pre">get_files_to_consider()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.compute_manifest.main"><code class="docutils literal notranslate"><span class="pre">main()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#impresso_commons.versioning.compute_manifest.validate_config"><code class="docutils literal notranslate"><span class="pre">validate_config()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Impresso PyCommons</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Data Versioning</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/versioning.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="data-versioning">
<h1>Data Versioning<a class="headerlink" href="#data-versioning" title="Link to this heading"></a></h1>
<p>The <cite>versioning</cite> package of <cite>impresso_commons</cite> contains several modules and scripts with classes and functions that allow to version Impresso’s data at various stages of the processing pipeline.</p>
<p>The main goal of this approach is to version the data and track information at every stage to:</p>
<ol class="arabic simple">
<li><p><strong>Ensure data consisteny and ease of debugging:</strong> Data elements should be consistent across stages, and inconsistencies/differences should be justifiable through the identification of data leakage points.</p></li>
<li><p><strong>Allow partial updates:</strong> It should be possible to (re)run all or part of the processes on subsets of the data, knowing which version of the data was used at each step. This can be necessary when new media collections arrive, or when an existing collection has been patched.</p></li>
<li><p><strong>Ensure transparency:</strong> Citation of the various data stages and datasets should be straightforward; users should know when using the interface exactly what versions they are using, and should be able to consult the precise statistics related to them.</p></li>
</ol>
<section id="module-impresso_commons.versioning.data_statistics">
<span id="data-statistics-and-newspaper-statistics"></span><h2>Data Statistics and Newspaper Statistics<a class="headerlink" href="#module-impresso_commons.versioning.data_statistics" title="Link to this heading"></a></h2>
<p>This module contains the definition of a data statistics class.</p>
<p>A DataStatstics object should be instantiated during each processing step of
the data preprocessing and augmentation of the Impresso project, and used to
progressively count the number of elements modified or added by the processing.</p>
<dl class="py class">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_statistics.DataStatistics">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.data_statistics.</span></span><span class="sig-name descname"><span class="pre">DataStatistics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data_stage</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#impresso_commons.versioning.helpers.DataStage" title="impresso_commons.versioning.helpers.DataStage"><span class="pre">DataStage</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">granularity</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">element</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">counts</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#impresso_commons.versioning.data_statistics.DataStatistics" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">ABC</span></code></p>
<p>Count statistics computed on a specific portion and granularity of the data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data_stage</strong> (<a class="reference internal" href="#impresso_commons.versioning.helpers.DataStage" title="impresso_commons.versioning.helpers.DataStage"><em>DataStage</em></a><em> | </em><em>str</em>) – The stage of data the stats are computed on.</p></li>
<li><p><strong>granularity</strong> (<em>str</em>) – The granularity of the statistics with respect to the data.</p></li>
<li><p><strong>element</strong> (<em>str</em><em>, </em><em>optional</em>) – The specific element associated with the statistics.
Defaults to “” (empty string).</p></li>
<li><p><strong>counts</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>int</em><em> | </em><em>dict</em><em>[</em><em>str</em><em>, </em><em>int</em><em>]</em><em>] </em><em>| </em><em>None</em><em>, </em><em>optional</em>) – Initial counts for
statistics. Defaults to None.</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_statistics.DataStatistics.stage">
<span class="sig-name descname"><span class="pre">stage</span></span><a class="headerlink" href="#impresso_commons.versioning.data_statistics.DataStatistics.stage" title="Link to this definition"></a></dt>
<dd><p>The stage of data the stats are computed on.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#impresso_commons.versioning.helpers.DataStage" title="impresso_commons.versioning.helpers.DataStage">DataStage</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_statistics.DataStatistics.granularity">
<span class="sig-name descname"><span class="pre">granularity</span></span><a class="headerlink" href="#impresso_commons.versioning.data_statistics.DataStatistics.granularity" title="Link to this definition"></a></dt>
<dd><p>The granularity of the statistics with respect to the data.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_statistics.DataStatistics.element">
<span class="sig-name descname"><span class="pre">element</span></span><a class="headerlink" href="#impresso_commons.versioning.data_statistics.DataStatistics.element" title="Link to this definition"></a></dt>
<dd><p>The specific element associated with the statistics.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_statistics.DataStatistics.count_keys">
<span class="sig-name descname"><span class="pre">count_keys</span></span><a class="headerlink" href="#impresso_commons.versioning.data_statistics.DataStatistics.count_keys" title="Link to this definition"></a></dt>
<dd><p>The count keys for these statistics.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list[str]</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_statistics.DataStatistics.counts">
<span class="sig-name descname"><span class="pre">counts</span></span><a class="headerlink" href="#impresso_commons.versioning.data_statistics.DataStatistics.counts" title="Link to this definition"></a></dt>
<dd><p>The count statistics computed on the
specific data, can include frequency dicts.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict[str, int | dict[str, int]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_statistics.DataStatistics.add_counts">
<span class="sig-name descname"><span class="pre">add_counts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">new_counts</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">replace</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#impresso_commons.versioning.data_statistics.DataStatistics.add_counts" title="Link to this definition"></a></dt>
<dd><p>Add new counts to the existing counts if the new keys are validated.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>new_counts</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>int</em><em> | </em><em>dict</em><em>[</em><em>str</em><em>, </em><em>int</em><em>]</em><em>]</em>) – New counts to be added.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if the counts were valid and could be added, False otherwise.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_statistics.DataStatistics.init_counts">
<span class="sig-name descname"><span class="pre">init_counts</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#impresso_commons.versioning.data_statistics.DataStatistics.init_counts" title="Link to this definition"></a></dt>
<dd><p>Initialize a dict with all the keys associated to this object.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>A dict with all defined keys, and values</dt><dd><p>initialized to 0 (or to empty frequency dicts).</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>dict[str, int | dict[str, int]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_statistics.DataStatistics.pretty_print">
<span class="sig-name descname"><span class="pre">pretty_print</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">modif_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_counts</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#impresso_commons.versioning.data_statistics.DataStatistics.pretty_print" title="Link to this definition"></a></dt>
<dd><p>Generate a dict representation of these statistics to add to a json.</p>
<p>These stats are agnostic to the type of statistics they represent so the values
of <cite>self.counts</cite> are excluded by default, to be included in child classes.
The modification date can also be included (when granularity=’year’)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>modif_date</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>None</em><em>]</em><em>, </em><em>optional</em>) – Last modification date of the
corresponding elements. Defaults to None.</p></li>
<li><p><strong>include_counts</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to include the current counts with
key “stats”. Defaults to False.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dict with the general information about these statistics.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict[str, Any]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_statistics.DataStatistics.same_counts">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">same_counts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other_stats</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Self</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#impresso_commons.versioning.data_statistics.DataStatistics.same_counts" title="Link to this definition"></a></dt>
<dd><p>Given another dict of stats, check whether the values are the same.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_statistics.NewspaperStatistics">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.data_statistics.</span></span><span class="sig-name descname"><span class="pre">NewspaperStatistics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data_stage</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#impresso_commons.versioning.helpers.DataStage" title="impresso_commons.versioning.helpers.DataStage"><span class="pre">DataStage</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">granularity</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">element</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">counts</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#impresso_commons.versioning.data_statistics.NewspaperStatistics" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#impresso_commons.versioning.data_statistics.DataStatistics" title="impresso_commons.versioning.data_statistics.DataStatistics"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataStatistics</span></code></a></p>
<p>Count statistics computed on a specific portion and granularity of the data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data_stage</strong> (<a class="reference internal" href="#impresso_commons.versioning.helpers.DataStage" title="impresso_commons.versioning.helpers.DataStage"><em>DataStage</em></a><em> | </em><em>str</em>) – The stage of data the stats are computed on.</p></li>
<li><p><strong>granularity</strong> (<em>str</em>) – The granularity of the statistics with respect to the data.</p></li>
<li><p><strong>element</strong> (<em>str</em><em>, </em><em>optional</em>) – The specific element associated with the statistics.
Defaults to “” (empty string).</p></li>
<li><p><strong>counts</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>int</em><em>] </em><em>| </em><em>None</em><em>, </em><em>optional</em>) – Initial counts for statistics.
Defaults to None.</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_statistics.NewspaperStatistics.stage">
<span class="sig-name descname"><span class="pre">stage</span></span><a class="headerlink" href="#impresso_commons.versioning.data_statistics.NewspaperStatistics.stage" title="Link to this definition"></a></dt>
<dd><p>The stage of data the stats are computed on.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#impresso_commons.versioning.helpers.DataStage" title="impresso_commons.versioning.helpers.DataStage">DataStage</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_statistics.NewspaperStatistics.granularity">
<span class="sig-name descname"><span class="pre">granularity</span></span><a class="headerlink" href="#impresso_commons.versioning.data_statistics.NewspaperStatistics.granularity" title="Link to this definition"></a></dt>
<dd><p>The granularity of the statistics with respect to the data.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_statistics.NewspaperStatistics.element">
<span class="sig-name descname"><span class="pre">element</span></span><a class="headerlink" href="#impresso_commons.versioning.data_statistics.NewspaperStatistics.element" title="Link to this definition"></a></dt>
<dd><p>The specific element associated with the statistics.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_statistics.NewspaperStatistics.count_keys">
<span class="sig-name descname"><span class="pre">count_keys</span></span><a class="headerlink" href="#impresso_commons.versioning.data_statistics.NewspaperStatistics.count_keys" title="Link to this definition"></a></dt>
<dd><p>The count keys for these statistics.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list[str]</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_statistics.NewspaperStatistics.counts">
<span class="sig-name descname"><span class="pre">counts</span></span><a class="headerlink" href="#impresso_commons.versioning.data_statistics.NewspaperStatistics.counts" title="Link to this definition"></a></dt>
<dd><p>The count statistics computed on the specific data.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict[str, int]</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_statistics.NewspaperStatistics.possible_count_keys">
<span class="sig-name descname"><span class="pre">possible_count_keys</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">['titles',</span> <span class="pre">'issues',</span> <span class="pre">'pages',</span> <span class="pre">'content_items_out',</span> <span class="pre">'ft_tokens',</span> <span class="pre">'images',</span> <span class="pre">'content_items_in',</span> <span class="pre">'ne_mentions',</span> <span class="pre">'ne_entities',</span> <span class="pre">'embeddings_el',</span> <span class="pre">'topics',</span> <span class="pre">'lang_fd',</span> <span class="pre">'text_reuse_clusters',</span> <span class="pre">'text_reuse_passages']</span></em><a class="headerlink" href="#impresso_commons.versioning.data_statistics.NewspaperStatistics.possible_count_keys" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_statistics.NewspaperStatistics.pretty_print">
<span class="sig-name descname"><span class="pre">pretty_print</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">modif_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_counts</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#impresso_commons.versioning.data_statistics.NewspaperStatistics.pretty_print" title="Link to this definition"></a></dt>
<dd><p>Generate a dict representation of these statistics to add to a json.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>modif_date</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>None</em><em>]</em><em>, </em><em>optional</em>) – Last modification date of the
corresponding elements. Defaults to None.</p></li>
<li><p><strong>include_counts</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to include the current newspaper
counts with key “nps_stats”. Defaults to True.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dict representation of these statistics.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict[str, Any]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_statistics.NewspaperStatistics.same_counts">
<span class="sig-name descname"><span class="pre">same_counts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other_stats</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Self</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#impresso_commons.versioning.data_statistics.NewspaperStatistics.same_counts" title="Link to this definition"></a></dt>
<dd><p>Given another dict of stats, check whether the values are the same.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>other_stats</strong> (<em>Union</em><em>[</em><em>dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em><em>, </em><em>Self</em><em>]</em>) – Dict with pretty-printed
newspaper statistics or other NewspaperStatistics object.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>True if the values for the various fields of <cite>nps_stats</cite> where the</dt><dd><p>same, False otherwise.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-impresso_commons.versioning.data_manifest">
<span id="data-manifest"></span><h2>Data Manifest<a class="headerlink" href="#module-impresso_commons.versioning.data_manifest" title="Link to this heading"></a></h2>
<p>This module contains the definition of a manifest class.</p>
<p>A manifest object should be instantiated for each processing step of the data
preprocessing and augmentation of the Impresso project.</p>
<dl class="py class">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_manifest.DataManifest">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.data_manifest.</span></span><span class="sig-name descname"><span class="pre">DataManifest</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data_stage</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#impresso_commons.versioning.helpers.DataStage" title="impresso_commons.versioning.helpers.DataStage"><span class="pre">DataStage</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">s3_output_bucket</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">git_repo</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Repo</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">temp_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">s3_input_bucket</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">staging</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_version</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">is_patch</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">patched_fields</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">previous_mft_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">only_counting</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">notes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">push_to_git</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#impresso_commons.versioning.data_manifest.DataManifest" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_manifest.DataManifest.add_by_ci_id">
<span class="sig-name descname"><span class="pre">add_by_ci_id</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ci_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">counts</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#impresso_commons.versioning.data_manifest.DataManifest.add_by_ci_id" title="Link to this definition"></a></dt>
<dd><p>Add new counts corresponding to a specific content-item ID.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ci_id</strong> (<em>str</em>) – Content-item canonical ID to which the counts correspond.</p></li>
<li><p><strong>counts</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>int</em><em>]</em>) – Counts corresponding to that ID.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if the processing stats’ update was successful, False otherwise.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_manifest.DataManifest.add_by_title_year">
<span class="sig-name descname"><span class="pre">add_by_title_year</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">title</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">counts</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#impresso_commons.versioning.data_manifest.DataManifest.add_by_title_year" title="Link to this definition"></a></dt>
<dd><p>Add new counts corresponding to a specific media title and year.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>title</strong> (<em>str</em>) – Media title to which the counts correspond.</p></li>
<li><p><strong>year</strong> (<em>str</em>) – Year to which the counts correspond.</p></li>
<li><p><strong>counts</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>int</em><em>]</em>) – Counts corresponding to that title and year.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if the processing stats’ update was successful, False otherwise.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_manifest.DataManifest.add_count_list_by_title_year">
<span class="sig-name descname"><span class="pre">add_count_list_by_title_year</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">title</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">all_counts</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#impresso_commons.versioning.data_manifest.DataManifest.add_count_list_by_title_year" title="Link to this definition"></a></dt>
<dd><p>Add a list of new counts corresponding to a specific media title and year.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>title</strong> (<em>str</em>) – Media title to which the counts correspond.</p></li>
<li><p><strong>year</strong> (<em>str</em>) – Year to which the counts correspond.</p></li>
<li><p><strong>all_counts</strong> (<em>list</em><em>[</em><em>dict</em><em>[</em><em>str</em><em>, </em><em>int</em><em>]</em><em>]</em>) – Lsit of counts for that title and year.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if all the updates were successful, False otherwise.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_manifest.DataManifest.aggregate_stats_for_title">
<span class="sig-name descname"><span class="pre">aggregate_stats_for_title</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">title</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">media_dict</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#impresso_commons.versioning.data_statistics.NewspaperStatistics" title="impresso_commons.versioning.data_statistics.NewspaperStatistics"><span class="pre">NewspaperStatistics</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#impresso_commons.versioning.data_manifest.DataManifest.aggregate_stats_for_title" title="Link to this definition"></a></dt>
<dd><p>Aggregate all stats of given title and export them to a “pretty print” dict.</p>
<p>TODO once the radio data is handled, add RadioStatistics</p>
<p>The <cite>DataStatistics</cite> objects don’t display in the dict format by default,
but need to be converted to dicts to show as desired on the final manifest.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>title</strong> (<em>str</em>) – Media title for which to aggregate the yearly stats.</p></li>
<li><p><strong>media_dict</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em>) – Title’s media dict with formatted statistics.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>Updated media dict and</dt><dd><p>corresponding title-level DataStatistics object.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple[dict[str, Any], <a class="reference internal" href="#impresso_commons.versioning.data_statistics.NewspaperStatistics" title="impresso_commons.versioning.data_statistics.NewspaperStatistics">NewspaperStatistics</a>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_manifest.DataManifest.append_to_notes">
<span class="sig-name descname"><span class="pre">append_to_notes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">contents</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">to_start</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#impresso_commons.versioning.data_manifest.DataManifest.append_to_notes" title="Link to this definition"></a></dt>
<dd><p>Append a string content to the manifest notes, initialize them if needed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>contents</strong> (<em>str</em>) – Text to add to the manifest notes.</p></li>
<li><p><strong>to_start</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether the contents should be added to the
start of the notes instead of the end. Defaults to True.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_manifest.DataManifest.compute">
<span class="sig-name descname"><span class="pre">compute</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">export_to_git_and_s3</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">commit_msg</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#impresso_commons.versioning.data_manifest.DataManifest.compute" title="Link to this definition"></a></dt>
<dd><p>Perform all necessary logic to compute and construct the resulting manifest.</p>
<p>This lazy behavior ensures all necessary information is ready and accessible
when generating the manifest (in particular the <cite>_processing_stats</cite>).</p>
<dl class="simple">
<dt>The steps of this computation are the following:</dt><dd><ul class="simple">
<li><p>Ensure <cite>_processing_stats</cite> is not empty so the manifest can be computed and
crystallize the time this function is called as the <cite>_generation_date</cite>.</p></li>
<li><p>Fetch the previous version of this manifest from S3, extract its media list.</p></li>
<li><p>Generate the new media list given the previous one and <cite>_processing_stats</cite>.</p></li>
<li><p>Compute the new title and corpus level statistics using the new media list.</p></li>
<li><p>Compute the new version based on the performed updates.</p></li>
<li><p>Define the <cite>manifest_data</cite> attribute corresponding to the final manifest.</p></li>
<li><p>Optionally, dump it to JSON, export it to S3 and Git.</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>export_to_git_and_s3</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to export the final
<cite>manifest_data</cite> as JSON to S3 and GitHub. Defaults to True. If False,
<cite>validate_and_export_manifest</cite> can be called separately to do it.</p></li>
<li><p><strong>commit_msg</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>None</em><em>]</em><em>, </em><em>optional</em>) – Commit message to use instead of
the default from <cite>validate_and_export_manifest</cite>. Defaults to None.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_manifest.DataManifest.define_update_info_for_title">
<span class="sig-name descname"><span class="pre">define_update_info_for_title</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">processed_years</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">set</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prev_version_years</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">set</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#impresso_commons.versioning.data_manifest.DataManifest.define_update_info_for_title" title="Link to this definition"></a></dt>
<dd><p>Define a title’s update info from the previous and newly updated years.</p>
<p>The update information for a given title corresponds to four keys, for which
the values provide information about what modifications took place during the
processing this manifest is documenting.</p>
<dl class="simple">
<dt>They are defined based on various values:</dt><dd><ul class="simple">
<li><p><cite>self.patched_fields</cite>: fields updated during the processing (eg. for a patch).</p></li>
<li><p><cite>processed_years</cite> and <cite>prev_version_years</cite></p></li>
</ul>
</dd>
<dt>Four cases exist:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>All newly processed years were in the previous version</dt><dd><p>-&gt; full title update, only modification.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Part of the previous years were updated, and no newly added years:</dt><dd><p>-&gt; year-specific update, where all modified years will be listed.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>All previous years were updated, and new years were added:</dt><dd><p>-&gt; full title update with addition.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Part of the previous years were updated, and new years were added:</dt><dd><p>-&gt; year-specific update, with addition.</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>processed_years</strong> (<em>set</em><em>[</em><em>str</em><em>]</em>) – Years for which statistics were computed for
this manifest.</p></li>
<li><p><strong>prev_version_years</strong> (<em>set</em><em>[</em><em>str</em><em>]</em>) – Years for which statistics has already been
computed for the previous version of this manifest.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>New update info dict for the given title.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict[str, Union[str, list]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_manifest.DataManifest.generate_media_dict">
<span class="sig-name descname"><span class="pre">generate_media_dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">old_media_list</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">dict</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">bool</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#impresso_commons.versioning.data_manifest.DataManifest.generate_media_dict" title="Link to this definition"></a></dt>
<dd><p>Given the previous manifest’s and current statistics, generate new media dict.</p>
<dl class="simple">
<dt>The previous version media list is updated with current processing media list:</dt><dd><ul class="simple">
<li><p>Setting new modification date &amp; git url for each modified title.</p></li>
<li><p>Compute update level &amp; targets if not the processing is not a patch.</p></li>
</ul>
</dd>
</dl>
<p>From this update, also conclude on whether new data was added, informing the
how the version should be increased: if new title-year keys exist, the “addition”
flag will conduct to a major verison increase.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>old_media_list</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>dict</em><em>]</em>) – _description_</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>_description_</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple[dict, bool]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_manifest.DataManifest.get_count_keys">
<span class="sig-name descname"><span class="pre">get_count_keys</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#impresso_commons.versioning.data_manifest.DataManifest.get_count_keys" title="Link to this definition"></a></dt>
<dd><p>Get the list of count keys for this manifest’s media dict.</p>
<p>TODO when integrating radio data: init RadioStatistics instead.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Count keys corresponding to this manifest’s DataStage.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>list[str]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_manifest.DataManifest.has_title_year_key">
<span class="sig-name descname"><span class="pre">has_title_year_key</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">title</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#impresso_commons.versioning.data_manifest.DataManifest.has_title_year_key" title="Link to this definition"></a></dt>
<dd><p>Verify whether the provided title and year have been processed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>title</strong> (<em>str</em>) – Media title to check.</p></li>
<li><p><strong>year</strong> (<em>str</em>) – Year to check.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if the title-year pair has instantiated counts, false otherwise.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_manifest.DataManifest.init_yearly_count_dict">
<span class="sig-name descname"><span class="pre">init_yearly_count_dict</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#impresso_commons.versioning.data_manifest.DataManifest.init_yearly_count_dict" title="Link to this definition"></a></dt>
<dd><p>Initialize new newspaper statistics counts for this manifest.</p>
<p>TODO when integrating radio data: init RadioStatistics instead.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Initialized counts for this manifest.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>dict[str, int]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_manifest.DataManifest.new_media">
<span class="sig-name descname"><span class="pre">new_media</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">title</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#impresso_commons.versioning.data_manifest.DataManifest.new_media" title="Link to this definition"></a></dt>
<dd><p>Add a new media dict to the media list, given its title.</p>
<dl class="simple">
<dt>By default, this means the update information will be the following:</dt><dd><ul class="simple">
<li><p>“update_type”: “addition”</p></li>
<li><p>“update_level”: “title”</p></li>
<li><p>“updated_years”: [] # all represented years will be new</p></li>
<li><p>“updated_fields”: [] # all fields will be new</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>title</strong> (<em>str</em>) – Media title for which to add a new media.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>_description_</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict[str, Any]</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_manifest.DataManifest.output_mft_s3_path">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">output_mft_s3_path</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span></em><a class="headerlink" href="#impresso_commons.versioning.data_manifest.DataManifest.output_mft_s3_path" title="Link to this definition"></a></dt>
<dd><p>Get this manifest’s output S3 path based on its output bucket.</p>
<p>The manifest will be uploaded to the S3 bucket and partition corresponding
to the value provided for its input argument <cite>s3_output_bucket</cite>.
If the versison attribute for this manifest is not defined, the S3 output
path cannot be provided and the empty string will be returned.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>Full S3 path of this manifest if the version is already defined,</dt><dd><p>the empty string otherwise.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_manifest.DataManifest.overall_stats">
<span class="sig-name descname"><span class="pre">overall_stats</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">title_stats</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#impresso_commons.versioning.data_statistics.DataStatistics" title="impresso_commons.versioning.data_statistics.DataStatistics"><span class="pre">DataStatistics</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#impresso_commons.versioning.data_manifest.DataManifest.overall_stats" title="Link to this definition"></a></dt>
<dd><p>Generate the overall stats and append the ones from the input manifest.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>title_stats</strong> (<em>list</em><em>[</em><a class="reference internal" href="#impresso_commons.versioning.data_statistics.DataStatistics" title="impresso_commons.versioning.data_statistics.DataStatistics"><em>DataStatistics</em></a><em>]</em>) – List of all title-level statistics
used to compute the overall stats.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>This manifest’s overall stats with the ones of previous stages.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list[dict]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_manifest.DataManifest.replace_by_ci_id">
<span class="sig-name descname"><span class="pre">replace_by_ci_id</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ci_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">counts</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#impresso_commons.versioning.data_manifest.DataManifest.replace_by_ci_id" title="Link to this definition"></a></dt>
<dd><p>Replace the current counts for a CI id’s title-year pair with new ones.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This operation will overwrite any current counts corresponding to the
media title and year of the provided content-item ID. If the goal isn’t
to overwrite these counts, <cite>add_by_ci_id</cite> is better suited.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ci_id</strong> (<em>str</em>) – Content-item canonical ID to which the counts correspond.</p></li>
<li><p><strong>counts</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>int</em><em>]</em>) – Counts for that ID to overwrite current counts with.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if the stats’ modification was successful, False otherwise.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_manifest.DataManifest.replace_by_title_year">
<span class="sig-name descname"><span class="pre">replace_by_title_year</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">title</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">counts</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#impresso_commons.versioning.data_manifest.DataManifest.replace_by_title_year" title="Link to this definition"></a></dt>
<dd><p>Replace the current counts for a given title-year pair with new ones.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This operation will overwrite any current counts corresponding to the
media title and year of the provided content-item ID. If the goal isn’t
to overwrite these counts, <cite>add_by_title_year</cite> is better suited.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>title</strong> (<em>str</em>) – Media title to which the counts correspond.</p></li>
<li><p><strong>year</strong> (<em>str</em>) – Year to which the counts correspond.</p></li>
<li><p><strong>counts</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>int</em><em>]</em>) – Counts for that ID to overwrite current counts with.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if the stats’ modification was successful, False otherwise.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_manifest.DataManifest.title_level_stats">
<span class="sig-name descname"><span class="pre">title_level_stats</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">media_list</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">dict</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#impresso_commons.versioning.data_statistics.DataStatistics" title="impresso_commons.versioning.data_statistics.DataStatistics"><span class="pre">DataStatistics</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">dict</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#impresso_commons.versioning.data_manifest.DataManifest.title_level_stats" title="Link to this definition"></a></dt>
<dd><p>Compute the title-level statistics from the new media list.</p>
<p>Also removes the <cite>stats_as_dict</cite> field from the media list, and returns
the media list with each NewspaperStatistics object “pretty printed”.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>media_list</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>dict</em><em>]</em>) – Updated media list for this manifest.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>New title-level stats and</dt><dd><p>media list.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple[list[<a class="reference internal" href="#impresso_commons.versioning.data_statistics.DataStatistics" title="impresso_commons.versioning.data_statistics.DataStatistics">DataStatistics</a>], dict[str, dict]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_manifest.DataManifest.update_media_stats">
<span class="sig-name descname"><span class="pre">update_media_stats</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">title</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">yearly_stats</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">dict</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">old_media_list</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">dict</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#impresso_commons.versioning.data_manifest.DataManifest.update_media_stats" title="Link to this definition"></a></dt>
<dd><p>Update a title’s media statistics given the its newly computed yearly stats.</p>
<p>Note that it’s actually the <cite>old_media_list</cite>’s contents which are updated when
necessary.</p>
<dl class="simple">
<dt>In addition, the value of <cite>self.only_counting</cite> will change the behavior:</dt><dd><ul class="simple">
<li><p>When False, the computation of the manifest should follow a processing, and
all data within the <cite>_processing_stats</cite> (here <cite>yearly_stats</cite> for 1 title) will
be considered to have been modified (or re-generated).</p></li>
<li><p>When True, the manifest is computed to verify the contents of the data, and
the media’s information will be update only if differences in statisitics are
found between the previous and current version.</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>title</strong> (<em>str</em>) – Media title for which to update the media list.</p></li>
<li><p><strong>yearly_stats</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>dict</em><em>]</em>) – New yearly statistics for the title.</p></li>
<li><p><strong>old_media_list</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>dict</em><em>]</em>) – Previous version manifest’ media list.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>Previous manifest’s media list potentially updated to match</dt><dd><p>new counts, and the list of years which have been modified</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Union[dict, list[str]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="impresso_commons.versioning.data_manifest.DataManifest.validate_and_export_manifest">
<span class="sig-name descname"><span class="pre">validate_and_export_manifest</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">push_to_git</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">commit_msg</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#impresso_commons.versioning.data_manifest.DataManifest.validate_and_export_manifest" title="Link to this definition"></a></dt>
<dd><p>Validate the current manifest against a schema and export it (s3 and Git).</p>
<p>This function will always upload the generated manifest to S3, using a path
constructed based on <cite>self.output_bucket_name</cite> and the DataStage.</p>
<p>If <cite>push_to_git</cite> is True, by default the commit message used will be
“Add generated manifest file {filename}.” It can be overriden.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If a problem occurs when pushing to Git, a critical message will be logged,
but it won’t modify or alter the upload of the manifest to S3.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>push_to_git</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to also push the generated manifest to
GitHub (impresso/impresso-data-release). Defaults to False.</p></li>
<li><p><strong>commit_msg</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>None</em><em>]</em><em>, </em><em>optional</em>) – Commit message to override the
default message. Defaults to None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Whether the upload to s3 was successful.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-impresso_commons.versioning.helpers">
<span id="versioning-helpers"></span><h2>Versioning Helpers<a class="headerlink" href="#module-impresso_commons.versioning.helpers" title="Link to this heading"></a></h2>
<p>Helper functions to read, generate and write data versioning manifests.</p>
<dl class="py class">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.DataStage">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.helpers.</span></span><span class="sig-name descname"><span class="pre">DataStage</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">names</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">module</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">qualname</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">boundary</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#impresso_commons.versioning.helpers.DataStage" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">StrEnum</span></code></p>
<p>Enum all stages requiring a versioning manifest.</p>
<p>Each member corresponds to a data stage and the associated string is used to name
each generated manifest accordingly.</p>
<p>TODO: finalize the exact list of names and strings based on needs.
TODO: add options for data indexing in Solr</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.DataStage.CANONICAL">
<span class="sig-name descname"><span class="pre">CANONICAL</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'canonical'</span></em><a class="headerlink" href="#impresso_commons.versioning.helpers.DataStage.CANONICAL" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.DataStage.EMBEDDINGS">
<span class="sig-name descname"><span class="pre">EMBEDDINGS</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'embeddings'</span></em><a class="headerlink" href="#impresso_commons.versioning.helpers.DataStage.EMBEDDINGS" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.DataStage.ENTITIES">
<span class="sig-name descname"><span class="pre">ENTITIES</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'entities'</span></em><a class="headerlink" href="#impresso_commons.versioning.helpers.DataStage.ENTITIES" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.DataStage.EVENIZED">
<span class="sig-name descname"><span class="pre">EVENIZED</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'evenized-rebuilt'</span></em><a class="headerlink" href="#impresso_commons.versioning.helpers.DataStage.EVENIZED" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.DataStage.LANGIDENT">
<span class="sig-name descname"><span class="pre">LANGIDENT</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'langident'</span></em><a class="headerlink" href="#impresso_commons.versioning.helpers.DataStage.LANGIDENT" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.DataStage.LINGUISTIC_PROCESSING">
<span class="sig-name descname"><span class="pre">LINGUISTIC_PROCESSING</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'lingproc'</span></em><a class="headerlink" href="#impresso_commons.versioning.helpers.DataStage.LINGUISTIC_PROCESSING" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.DataStage.MYSQL_CIS">
<span class="sig-name descname"><span class="pre">MYSQL_CIS</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'mysql-ingestion'</span></em><a class="headerlink" href="#impresso_commons.versioning.helpers.DataStage.MYSQL_CIS" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.DataStage.OCRQA">
<span class="sig-name descname"><span class="pre">OCRQA</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'ocrqa'</span></em><a class="headerlink" href="#impresso_commons.versioning.helpers.DataStage.OCRQA" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.DataStage.PASSIM">
<span class="sig-name descname"><span class="pre">PASSIM</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'passim'</span></em><a class="headerlink" href="#impresso_commons.versioning.helpers.DataStage.PASSIM" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.DataStage.REBUILT">
<span class="sig-name descname"><span class="pre">REBUILT</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'rebuilt'</span></em><a class="headerlink" href="#impresso_commons.versioning.helpers.DataStage.REBUILT" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.DataStage.SOLR_EMBS">
<span class="sig-name descname"><span class="pre">SOLR_EMBS</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'solr-ingestion-emb'</span></em><a class="headerlink" href="#impresso_commons.versioning.helpers.DataStage.SOLR_EMBS" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.DataStage.SOLR_ENTITIES">
<span class="sig-name descname"><span class="pre">SOLR_ENTITIES</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'solr-ingestion-entities'</span></em><a class="headerlink" href="#impresso_commons.versioning.helpers.DataStage.SOLR_ENTITIES" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.DataStage.SOLR_TEXT">
<span class="sig-name descname"><span class="pre">SOLR_TEXT</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'solr-ingestion-text'</span></em><a class="headerlink" href="#impresso_commons.versioning.helpers.DataStage.SOLR_TEXT" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.DataStage.TEXT_REUSE">
<span class="sig-name descname"><span class="pre">TEXT_REUSE</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'text-reuse'</span></em><a class="headerlink" href="#impresso_commons.versioning.helpers.DataStage.TEXT_REUSE" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.DataStage.TOPICS">
<span class="sig-name descname"><span class="pre">TOPICS</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'topics'</span></em><a class="headerlink" href="#impresso_commons.versioning.helpers.DataStage.TOPICS" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.DataStage.has_value">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">has_value</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#impresso_commons.versioning.helpers.DataStage.has_value" title="Link to this definition"></a></dt>
<dd><p>Check if enum contains given value</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cls</strong> (<em>Self</em>) – This DataStage class</p></li>
<li><p><strong>value</strong> (<em>str</em>) – Value to check</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if the value provided is in this enum’s values, False otherwise.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.agg">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.helpers.</span></span><span class="sig-name descname"><span class="pre">agg</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">s</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#impresso_commons.versioning.helpers.agg" title="Link to this definition"></a></dt>
<dd><p>The function which will aggregate the result from all the partitions (reduce).</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.chunk">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.helpers.</span></span><span class="sig-name descname"><span class="pre">chunk</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">s</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#impresso_commons.versioning.helpers.chunk" title="Link to this definition"></a></dt>
<dd><p>The function applied to the individual partition (map).</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.clone_git_repo">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.helpers.</span></span><span class="sig-name descname"><span class="pre">clone_git_repo</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">repo_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'impresso/impresso-data-release'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">branch</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'master'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Repo</span></span></span><a class="headerlink" href="#impresso_commons.versioning.helpers.clone_git_repo" title="Link to this definition"></a></dt>
<dd><p>Clone a git repository into a given path in the local file-system.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>path</strong> (<em>str</em>) – Path (ideally absolute) to the dir in which to clone the git repo.</p></li>
<li><p><strong>repo_name</strong> (<em>str</em><em>, </em><em>optional</em>) – Full name of the git repository to clone, as it
appears in its URL. Defaults to “impresso/impresso-data-release”.</p></li>
<li><p><strong>branch</strong> (<em>str</em><em>, </em><em>optional</em>) – Specific branch to clone. Defaults to “master”.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>e</strong> – Cloning the repo failed, both using SSH and HTTPS.</p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Object representing the cloned repository if it was cloned.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>git.Repo</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.compute_stats_in_canonical_bag">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.helpers.</span></span><span class="sig-name descname"><span class="pre">compute_stats_in_canonical_bag</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">s3_canonical_issues</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Bag</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">client</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Client</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#impresso_commons.versioning.helpers.compute_stats_in_canonical_bag" title="Link to this definition"></a></dt>
<dd><p>Computes number of issues and pages per newspaper from a Dask bag of canonical data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>s3_canonical_issues</strong> (<em>db.core.Bag</em>) – Bag with the contents of canonical files to
compute statistics on.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>List of counts that match canonical DataStatistics keys.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list[dict[str, Any]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.compute_stats_in_entities_bag">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.helpers.</span></span><span class="sig-name descname"><span class="pre">compute_stats_in_entities_bag</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">s3_entities</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Bag</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">client</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Client</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#impresso_commons.versioning.helpers.compute_stats_in_entities_bag" title="Link to this definition"></a></dt>
<dd><p>Compute stats on a dask bag of entities output content-items.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>s3_entities</strong> (<em>db.core.Bag</em>) – Bag with the contents of entity files.</p></li>
<li><p><strong>client</strong> (<em>Client</em><em> | </em><em>None</em><em>, </em><em>optional</em>) – Dask client. Defaults to None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>List of counts that match NE DataStatistics keys.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list[dict[str, Any]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.compute_stats_in_langident_bag">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.helpers.</span></span><span class="sig-name descname"><span class="pre">compute_stats_in_langident_bag</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">s3_langident</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Bag</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">client</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Client</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#impresso_commons.versioning.helpers.compute_stats_in_langident_bag" title="Link to this definition"></a></dt>
<dd><p>Compute stats on a dask bag of langident output content-items.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>s3_langident</strong> (<em>db.core.Bag</em>) – Bag of lang-id content-items.</p></li>
<li><p><strong>client</strong> (<em>Client</em><em> | </em><em>None</em><em>, </em><em>optional</em>) – Dask client. Defaults to None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>List of counts that match langident DataStatistics keys.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list[dict[str, Any]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.compute_stats_in_rebuilt_bag">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.helpers.</span></span><span class="sig-name descname"><span class="pre">compute_stats_in_rebuilt_bag</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rebuilt_articles</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Bag</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_np</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">passim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">client</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Client</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#impresso_commons.versioning.helpers.compute_stats_in_rebuilt_bag" title="Link to this definition"></a></dt>
<dd><p>Compute stats on a dask bag of rebuilt output content-items.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rebuilt_articles</strong> (<em>db.core.Bag</em>) – Bag with the contents of rebuilt files.</p></li>
<li><p><strong>key</strong> (<em>str</em><em>, </em><em>optional</em>) – Optionally title-year pair for on-the-fly computation.
Defaults to “”.</p></li>
<li><p><strong>include_np</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to include the title in the groupby,
not necessary for on-the-fly computation. Defaults to False.</p></li>
<li><p><strong>passim</strong> (<em>bool</em><em>, </em><em>optional</em>) – True if rebuilt is in passim format. Defaults to False.</p></li>
<li><p><strong>client</strong> (<em>Client</em><em> | </em><em>None</em><em>, </em><em>optional</em>) – Dask client. Defaults to None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>List of counts that match rebuilt or paassim</dt><dd><p>DataStatistics keys.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list[dict[str, Union[int, str]]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.compute_stats_in_solr_text_bag">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.helpers.</span></span><span class="sig-name descname"><span class="pre">compute_stats_in_solr_text_bag</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">s3_solr_text</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Bag</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">client</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Client</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#impresso_commons.versioning.helpers.compute_stats_in_solr_text_bag" title="Link to this definition"></a></dt>
<dd><p>Compute stats on a dask bag of content-items formatted for Solr input.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>s3_solr_text</strong> (<em>db.core.Bag</em>) – Bag or Solr formatted content-items.</p></li>
<li><p><strong>client</strong> (<em>Client</em><em> | </em><em>None</em><em>, </em><em>optional</em>) – Dask client. Defaults to None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>List of counts that match solr text DataStatistics keys.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list[dict[str, Any]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.counts_for_canonical_issue">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.helpers.</span></span><span class="sig-name descname"><span class="pre">counts_for_canonical_issue</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">issue</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_np_yr</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#impresso_commons.versioning.helpers.counts_for_canonical_issue" title="Link to this definition"></a></dt>
<dd><p>Given the canonical representation of an issue, get its counts.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>issue</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em>) – Canonical JSON representation of an issue.</p></li>
<li><p><strong>include_np_yr</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether the newspaper title and year should
be included in the returned dict for later aggregation. Defaults to False.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Dict listing the counts for this issue, ready to be aggregated.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict[str, int]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.counts_for_rebuilt">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.helpers.</span></span><span class="sig-name descname"><span class="pre">counts_for_rebuilt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rebuilt_ci</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_np</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">passim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#impresso_commons.versioning.helpers.counts_for_rebuilt" title="Link to this definition"></a></dt>
<dd><p>Define the counts for 1 given rebuilt content-item to match the count keys.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rebuilt_ci</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em>) – Rebuilt content-item from which to extract counts.</p></li>
<li><p><strong>include_np</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to include the title in resulting dict,
not necessary for on-the-fly computation. Defaults to False.</p></li>
<li><p><strong>passim</strong> (<em>bool</em><em>, </em><em>optional</em>) – True if rebuilt is in passim format. Defaults to False.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Dict with rebuilt (passim) keys and counts for 1 CI.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict[str, Union[int, str]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.extract_version">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.helpers.</span></span><span class="sig-name descname"><span class="pre">extract_version</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name_or_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">as_int</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">int</span></span></span><a class="headerlink" href="#impresso_commons.versioning.helpers.extract_version" title="Link to this definition"></a></dt>
<dd><p>Extract the version from a string filename or path.</p>
<p>This function is in particular mean to extract the version from paths or filenames
of manifests: structured as [data-stage]_vM-m-p.json.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name_or_path</strong> (<em>str</em>) – Filename or path from which to extract the version.</p></li>
<li><p><strong>as_int</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to return the extracted version as int or str.
Defaults to False.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Extracted version, as int or str based on <cite>as_int</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Union[str, int]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.filter_new_or_modified_media">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.helpers.</span></span><span class="sig-name descname"><span class="pre">filter_new_or_modified_media</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rebuilt_mft_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">previous_mft_path_str</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#impresso_commons.versioning.helpers.filter_new_or_modified_media" title="Link to this definition"></a></dt>
<dd><p>Compares two manifests to determine new or modified media items.</p>
<p>Typical use-case is during an atomic update, when only media items added or modified
compared to the previous process need to be ingested or processed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rebuilt_mft_path</strong> (<em>str</em>) – Path of the rebuilt manifest (new).</p></li>
<li><p><strong>previous_mft_path_str</strong> (<em>str</em>) – Path of the previous process manifest.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A manifest identical to ‘rebuilt_mft_path’ but only with
media items that are new or modified in the media list.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list[dict[str, Any]]</p>
</dd>
</dl>
<p>Example: &gt;&gt;&gt; new_or_modified = get_new_or_modified_media(“new_manifest.json”,
“previous_manifest.json”) &gt;&gt;&gt; print(new_or_modified) [{‘media_title’:
‘new_media_item_1’, ‘last_modif_date’: ‘2024-04-04T12:00:00Z’, etc.},
{‘media_title’: ‘modified_media_item_2’, ‘last_modif_date’:
‘2024-04-03T12:00:00Z’, etc.}]</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.finalize">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.helpers.</span></span><span class="sig-name descname"><span class="pre">finalize</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">s</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#impresso_commons.versioning.helpers.finalize" title="Link to this definition"></a></dt>
<dd><p>The optional function that will be applied to the result of the agg_tu functions.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.find_s3_data_manifest_path">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.helpers.</span></span><span class="sig-name descname"><span class="pre">find_s3_data_manifest_path</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bucket_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_stage</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#impresso_commons.versioning.helpers.find_s3_data_manifest_path" title="Link to this definition"></a></dt>
<dd><p>Find and return the latest data manifest in a given S3 bucket.</p>
<p>On S3, different Data stages will be stored in different ways.
In particular, data stages corresponding to enrichments are all placed in the
same bucket but in different partitions.
Data stages “canonical”, “rebuilt”, “evenized-rebuilt” &amp; ones related to Solr
are the ones where each stage has its own bucket.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>bucket_name</strong> (<em>str</em>) – Name of the bucket in which to look.</p></li>
<li><p><strong>data_stage</strong> (<em>str</em>) – Data stage corresponding to the manifest to fetch.</p></li>
<li><p><strong>partition</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>None</em><em>]</em><em>, </em><em>optional</em>) – Partition within the bucket to look
into. Defaults to None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>S3 path of the latest manifest in the bucket, None if no</dt><dd><p>manifests were found inside.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Union[str, None]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.get_head_commit_url">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.helpers.</span></span><span class="sig-name descname"><span class="pre">get_head_commit_url</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">repo</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Repo</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="headerlink" href="#impresso_commons.versioning.helpers.get_head_commit_url" title="Link to this definition"></a></dt>
<dd><p>Get the URL of the last commit on a given Git repository.</p>
<p>TODO: test the function when repo is https url of repository.
TODO: provide branch argument.</p>
<dl class="simple">
<dt><cite>repo</cite> can be one of three things:</dt><dd><ul class="simple">
<li><p>a git.Repo instantiated object (if alreaday instantiated outside).</p></li>
<li><p>the local path to the git repository (previously cloned).</p></li>
<li><p>the HTTPS URL to the Git repository.</p></li>
</ul>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The returned commit URL corresponds to the one on the repository’s active
branch (master for the URL).</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>repo</strong> (<em>str</em><em> | </em><em>git.Repo</em>) – local path, git.Repo object or URL of the repository.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The HTTPS URL of the last commit on the git repository’s master branch.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.get_media_item_years">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.helpers.</span></span><span class="sig-name descname"><span class="pre">get_media_item_years</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mnf_json</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#impresso_commons.versioning.helpers.get_media_item_years" title="Link to this definition"></a></dt>
<dd><p>Retrieves the s3 key and size in MB of each year of media items from a manifest.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>mnf_json</strong> (<em>dict</em>) – A manifest dictionary.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>A dictionary where media titles are keys,</dt><dd><p>and each value is a dictionary with s3 key as key and its size as value.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>media_items_years (dict)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.get_media_titles">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.helpers.</span></span><span class="sig-name descname"><span class="pre">get_media_titles</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#impresso_commons.versioning.helpers.get_media_titles" title="Link to this definition"></a></dt>
<dd><p>Extracts media titles from the input data which can be either a manifest
or a media list.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>input_data</strong> (<em>Union</em><em>[</em><em>dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em><em>, </em><em>list</em><em>[</em><em>dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em><em>]</em><em>]</em>) – A manifest dictionary
or the media list of a manifest.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A list of media titles extracted from the input data.
Ex:  [‘Title 1’, ‘Title 2’]</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list[str]</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>TypeError</strong> – If the input data is not in the expected format.</p></li>
<li><p><strong>KeyError</strong> – If the ‘media_title’ key is not found in the input data.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.git_commit_push">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.helpers.</span></span><span class="sig-name descname"><span class="pre">git_commit_push</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">full_git_filepath</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">git_repo</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Repo</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">commit_msg</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#impresso_commons.versioning.helpers.git_commit_push" title="Link to this definition"></a></dt>
<dd><p>Commit and push the addition of a given file within the repository.</p>
<p>TODO: make more general for non-manifest related uses?</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>full_git_filepath</strong> (<em>str</em>) – Path to the file added to the git repository.</p></li>
<li><p><strong>git_repo</strong> (<em>git.Repo</em>) – git.Repo object of the repository to commit and push to.</p></li>
<li><p><strong>commit_msg</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>None</em><em>]</em><em>, </em><em>optional</em>) – Message to use when commiting. If not
defined, a basic message on the added manifest will be used. Defaults to None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Whether the commit and push operations were successful.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.increment_version">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.helpers.</span></span><span class="sig-name descname"><span class="pre">increment_version</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">prev_version</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">increment</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="headerlink" href="#impresso_commons.versioning.helpers.increment_version" title="Link to this definition"></a></dt>
<dd><p>Update  given version accoding to the given increment.</p>
<p>When the increment is major or minor, all following numbers are reset to 0.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>prev_version</strong> (<em>str</em>) – Version to increment</p></li>
<li><p><strong>increment</strong> (<em>str</em>) – Increment, can be one of major, minor and patch.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>e</strong> – Increment value provided is not valid.</p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Vesion incremented accordingly.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.init_media_info">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.helpers.</span></span><span class="sig-name descname"><span class="pre">init_media_info</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">add</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">full_title</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">years</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fields</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#impresso_commons.versioning.helpers.init_media_info" title="Link to this definition"></a></dt>
<dd><p>Initialize the media update dict for a title given relevant information.</p>
<p>All the update informations are relating to the newly processed data, in
comparison with the one computed during the last processing.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>add</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether new data was added. Defaults to True.</p></li>
<li><p><strong>full_title</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether all the title’s years were modified.
Defaults to True.</p></li>
<li><p><strong>years</strong> (<em>Union</em><em>[</em><em>list</em><em>[</em><em>str</em><em>]</em><em>, </em><em>None</em><em>]</em><em>, </em><em>optional</em>) – When <cite>full_title</cite>, the specific years
which were modified/updated. Defaults to None.</p></li>
<li><p><strong>fields</strong> (<em>Union</em><em>[</em><em>list</em><em>[</em><em>str</em><em>]</em><em>, </em><em>None</em><em>]</em><em>, </em><em>optional</em>) – List of specific fields that were
modified/updated. Defaults to None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Instantiated dict with the update information for a given media.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict[str, Any]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.is_git_repo">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.helpers.</span></span><span class="sig-name descname"><span class="pre">is_git_repo</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">bool</span></span></span><a class="headerlink" href="#impresso_commons.versioning.helpers.is_git_repo" title="Link to this definition"></a></dt>
<dd><p>Check if a directory contains a Git repository.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>path</strong> (<em>str</em>) – The path to the directory to be checked.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True if the directory contains a Git repository, False otherwise.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.manifest_summary">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.helpers.</span></span><span class="sig-name descname"><span class="pre">manifest_summary</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mnf_json</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extended_summary</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#impresso_commons.versioning.helpers.manifest_summary" title="Link to this definition"></a></dt>
<dd><p>Generate a summary of the manifest data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mnf_json</strong> (<em>dict</em>) – A dictionary containing manifest data.</p></li>
<li><p><strong>extended_summary</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to include extended summary</p></li>
<li><p><strong>False.</strong> (<em>with year statistics. Defaults to</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p>Prints: Summary of the manifest including the number of media items, additions,
and modifications.</p>
<p class="rubric">Example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">manifest_summary</span><span class="p">(</span><span class="n">manifest_json</span><span class="p">)</span>
<span class="go">Summary of manifest /path/to/manifest.json:</span>
<span class="go">Number of media items: 10 (8 from set)</span>
<span class="go">Number of addition at title level: 5</span>
<span class="go">Number of addition at year level: 3</span>
<span class="go">Number of modification at title level: 2</span>
<span class="go">Number of modification at year level: 1</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.media_list_from_mft_json">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.helpers.</span></span><span class="sig-name descname"><span class="pre">media_list_from_mft_json</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">json_mft</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">dict</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#impresso_commons.versioning.helpers.media_list_from_mft_json" title="Link to this definition"></a></dt>
<dd><p>Extract the <cite>media_list</cite> from a manifest as a dict where each title is a key.</p>
<p>For each title, all fields from the original media list will still be present
along with an additional <cite>stats_as_dict</cite> field containing a dict mapping each
year to its specific statistics.</p>
<dl class="simple">
<dt>As a result:</dt><dd><ul class="simple">
<li><p>All represented titles are within the keys of the returned media list.</p></li>
<li><p>For each title, represented years are in the keys of its <cite>stats_as_dict</cite> field.</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>json_mft</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em>) – Dict following the JSON schema of a manifest from
which to extract the media list.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Media list of given manifest, with <cite>stats_as_dict</cite> field.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict[str, dict]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.read_manifest_from_s3">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.helpers.</span></span><span class="sig-name descname"><span class="pre">read_manifest_from_s3</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bucket_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_stage</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#impresso_commons.versioning.helpers.DataStage" title="impresso_commons.versioning.helpers.DataStage"><span class="pre">DataStage</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">partition</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">None</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">None</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#impresso_commons.versioning.helpers.read_manifest_from_s3" title="Link to this definition"></a></dt>
<dd><p>Read and load manifest given an S3 bucket.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>bucket_name</strong> (<em>str</em>) – NAme of the s3 bucket to look into</p></li>
<li><p><strong>data_stage</strong> (<em>Union</em><em>[</em><a class="reference internal" href="#impresso_commons.versioning.helpers.DataStage" title="impresso_commons.versioning.helpers.DataStage"><em>DataStage</em></a><em>, </em><em>str</em><em>]</em>) – Data stage corresponding to the
manifest to fetch.</p></li>
<li><p><strong>partition</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>None</em><em>]</em><em>, </em><em>optional</em>) – Partition within the bucket to look
into. Defaults to None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>S3 path of the manifest</dt><dd><p>and corresponding contents, if a manifest was found, None otherwise.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Union[tuple[str, dict[str, Any]], tuple[None, None]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.read_manifest_from_s3_path">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.helpers.</span></span><span class="sig-name descname"><span class="pre">read_manifest_from_s3_path</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">manifest_s3_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#impresso_commons.versioning.helpers.read_manifest_from_s3_path" title="Link to this definition"></a></dt>
<dd><p>read and extract the contents of an arbitrary manifest,</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>manifest_s3_path</strong> (<em>str</em>) – S3 path of the manifest to read.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Contents of manifest if found on S3, None otherwise.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Union[dict[str, Any], None]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.remove_media_in_manifest">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.helpers.</span></span><span class="sig-name descname"><span class="pre">remove_media_in_manifest</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mnf_json</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">white_list</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#impresso_commons.versioning.helpers.remove_media_in_manifest" title="Link to this definition"></a></dt>
<dd><p>Removes media items from the given manifest JSON object based on a whitelist.
Typical use case is ingestion or processing only part of the media for whatever reason.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>mnf_json</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em>) – The manifest JSON object containing a ‘media_list’.</p></li>
<li><p><strong>white_list</strong> (<em>list</em><em>[</em><em>str</em><em>]</em>) – A list of media titles to be retained in the manifest.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Modifies the input manifest JSON object in-place by removing media items
not in the whitelist.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.validate_granularity">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.helpers.</span></span><span class="sig-name descname"><span class="pre">validate_granularity</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#impresso_commons.versioning.helpers.validate_granularity" title="Link to this definition"></a></dt>
<dd><p>Validate that the granularity value provided is valid.</p>
<p>Statistics are computed on three granularity levels:
corpus, title and year.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>value</strong> (<em>str</em>) – Granularity value to validate</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – The provided granularity isn’t one of corpus, title and year.</p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The provided value, in lower case, or None if not valid.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>Union[str, None]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.validate_stage">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.helpers.</span></span><span class="sig-name descname"><span class="pre">validate_stage</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data_stage</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_value_str</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#impresso_commons.versioning.helpers.DataStage" title="impresso_commons.versioning.helpers.DataStage"><span class="pre">DataStage</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#impresso_commons.versioning.helpers.validate_stage" title="Link to this definition"></a></dt>
<dd><p>Validate the provided data stage if it’s in the DataStage Enum (key or value).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data_stage</strong> (<em>str</em>) – Data stage key or value to validate.</p></li>
<li><p><strong>return_value_str</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to return the data stage’s value if
it was valid. Defaults to False.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>e</strong> – The provided str is neither a data stage key nor value.</p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>The corresponding DataStage or value string if valid.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="#impresso_commons.versioning.helpers.DataStage" title="impresso_commons.versioning.helpers.DataStage">DataStage</a> | str | None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.validate_version">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.helpers.</span></span><span class="sig-name descname"><span class="pre">validate_version</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">v</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">regex</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'^v([0-9]+[.]){2}[0-9]+$'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#impresso_commons.versioning.helpers.validate_version" title="Link to this definition"></a></dt>
<dd><p>Validate the provided string version against a regex.</p>
<p>The provided version should be in format “vM.m.p”, where M, m and p are
integers representing respectively the Major, minor and patch version.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>v</strong> (<em>str</em>) – version in string format to validate.</p></li>
<li><p><strong>regex</strong> (<em>str</em><em>, </em><em>optional</em>) – Regex against which to match the version.
Defaults to “^v([0-9]+[.]){2}[0-9]+$”.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The provided version if it’s valid, None otherwise.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Union[str, None]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.version_as_list">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.helpers.</span></span><span class="sig-name descname"><span class="pre">version_as_list</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">version</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#impresso_commons.versioning.helpers.version_as_list" title="Link to this definition"></a></dt>
<dd><p>Return the provided string version as a list of three ints.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>version</strong> (<em>str</em>) – String version to return as list</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>list of len 3 where indices respecively correspond to the</dt><dd><p>Major, minor and patch versions.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list[int]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.write_and_push_to_git">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.helpers.</span></span><span class="sig-name descname"><span class="pre">write_and_push_to_git</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_contents</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">git_repo</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Repo</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path_in_repo</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">commit_msg</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">bool</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#impresso_commons.versioning.helpers.write_and_push_to_git" title="Link to this definition"></a></dt>
<dd><p>Given a serialized dump, write it in local git repo, commit and push.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file_contents</strong> (<em>str</em>) – Serialized dump of a JSON file.</p></li>
<li><p><strong>git_repo</strong> (<em>git.Repo</em>) – Object representing the git repository to push to.</p></li>
<li><p><strong>path_in_repo</strong> (<em>str</em>) – Relative path where to write the file.</p></li>
<li><p><strong>filename</strong> (<em>str</em>) – Desired name for the file, including extension.</p></li>
<li><p><strong>commit_msg</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>None</em><em>]</em><em>, </em><em>optional</em>) – Commit message. If not defined, a
basic message on the added manifest will be used.Defaults to None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Whether the process was successful and corresponding filepath.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple[bool, str]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.helpers.write_dump_to_fs">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.helpers.</span></span><span class="sig-name descname"><span class="pre">write_dump_to_fs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_contents</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">abs_path</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#impresso_commons.versioning.helpers.write_dump_to_fs" title="Link to this definition"></a></dt>
<dd><p>Write a provided string dump to the local filesystem given its path and filename.</p>
<p>TODO: Potentially moving this method to <cite>utils.py</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file_contents</strong> (<em>str</em>) – Dumped contents in str format, ready to be written.</p></li>
<li><p><strong>abs_path</strong> (<em>str</em>) – Local path to the directory in which the file will be.</p></li>
<li><p><strong>filename</strong> (<em>str</em>) – Filename of the file to write, including its extension.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Full path of writen file, or None if an IOError occurred.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Union[str, None]</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-impresso_commons.versioning.compute_manifest">
<span id="manifest-computing-script"></span><h2>Manifest Computing Script<a class="headerlink" href="#module-impresso_commons.versioning.compute_manifest" title="Link to this heading"></a></h2>
<p>Command-line script to generate a manifest for an S3 bucket or partition after a processing.</p>
<dl class="simple">
<dt>Usage:</dt><dd><p>compute_manifest.py –config-file=&lt;cf&gt; –log-file=&lt;lf&gt; [–scheduler=&lt;sch&gt; –nworkers=&lt;nw&gt; –verbose]</p>
</dd>
</dl>
<p>Options:</p>
<dl class="option-list">
<dt><kbd><span class="option">--config-file=<var>&lt;cf&gt;</var></span></kbd></dt>
<dd><p>Path to configuration json file containing all necessary arguments for the computation of the manifest.</p>
</dd>
<dt><kbd><span class="option">--log-file=<var>&lt;lf&gt;</var></span></kbd></dt>
<dd><p>Path to log file to use.</p>
</dd>
<dt><kbd><span class="option">--scheduler=<var>&lt;sch&gt;</var></span></kbd></dt>
<dd><p>Tell dask to use an existing scheduler (otherwise it’ll create one)</p>
</dd>
<dt><kbd><span class="option">--nworkers=<var>&lt;nw&gt;</var></span></kbd></dt>
<dd><p>number of workers for (local) Dask client.</p>
</dd>
<dt><kbd><span class="option">--verbose</span></kbd></dt>
<dd><p>Set logging level to DEBUG (by default is INFO).</p>
</dd>
</dl>
<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.compute_manifest.compute_stats_for_stage">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.compute_manifest.</span></span><span class="sig-name descname"><span class="pre">compute_stats_for_stage</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">files_bag</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Bag</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stage</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#impresso_commons.versioning.helpers.DataStage" title="impresso_commons.versioning.helpers.DataStage"><span class="pre">DataStage</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">client</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Client</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">dict</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#impresso_commons.versioning.compute_manifest.compute_stats_for_stage" title="Link to this definition"></a></dt>
<dd><p>Compute statistics for a specific data stage.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>files_bag</strong> (<em>db.core.Bag</em>) – A bag containing files for statistics computation.</p></li>
<li><p><strong>stage</strong> (<a class="reference internal" href="#impresso_commons.versioning.helpers.DataStage" title="impresso_commons.versioning.helpers.DataStage"><em>DataStage</em></a>) – The data stage for which statistics are computed.</p></li>
<li><p><strong>client</strong> (<em>Client</em><em> | </em><em>None</em><em>, </em><em>optional</em>) – Dask client to use.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>List of computed yearly statistics, or None if statistics</dt><dd><p>computation for the given stage is not implemented.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list[dict] | None]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.compute_manifest.create_manifest">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.compute_manifest.</span></span><span class="sig-name descname"><span class="pre">create_manifest</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config_dict</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">client</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Client</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#impresso_commons.versioning.compute_manifest.create_manifest" title="Link to this definition"></a></dt>
<dd><p>Given its configuration, generate the manifest for a given s3 bucket partition.</p>
<p>TODO: add option to agg for all titles together if desired
TODO: add iptions to exclude NP for all agg types
TODO: separate further into functions</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The contents of the configuration file (or dict) are given in markdown file
<cite>impresso_commons/data/manifest_config/manifest.config.example.md`</cite></p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>config_dict</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em>) – Configuration following the guidelines.</p></li>
<li><p><strong>client</strong> (<em>Client</em><em> | </em><em>None</em><em>, </em><em>optional</em>) – Dask client to use.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.compute_manifest.extract_np_key">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.compute_manifest.</span></span><span class="sig-name descname"><span class="pre">extract_np_key</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">s3_key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bucket</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="headerlink" href="#impresso_commons.versioning.compute_manifest.extract_np_key" title="Link to this definition"></a></dt>
<dd><p>Extract the newspaper an s3:key corresponds to given the bucket and partition</p>
<p>eg. s3_key is in format:
- s3_key: ‘s3://31-passim-rebuilt-staging/passim/indeplux/indeplux-1889.jsonl.bz2’
- bucket: ‘31-passim-rebuilt-staging/passim’
–&gt; returns ‘indeplux’</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>s3_key</strong> (<em>str</em>) – Full S3 path of a file (as returned by fixed_s3fs_glob).</p></li>
<li><p><strong>bucket</strong> (<em>str</em>) – S3 bucket, including partition, in which the newspaper dirs are.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Name of the corresponding newspaper, extracted form the s3 path.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.compute_manifest.get_files_to_consider">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.compute_manifest.</span></span><span class="sig-name descname"><span class="pre">get_files_to_consider</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">list</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span></span><a class="headerlink" href="#impresso_commons.versioning.compute_manifest.get_files_to_consider" title="Link to this definition"></a></dt>
<dd><p>Get the list of S3 files to consider based on the provided configuration.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>config</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em>) – Configuration parameters with the s3 bucket, titles,
and file extensions</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>Dict mapping each newspaper to the s3 files to</dt><dd><p>consider, or None if no files found.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict[str, list[str]] | None</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If <cite>file_extensions</cite> in the config is empty or None.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.compute_manifest.main">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.compute_manifest.</span></span><span class="sig-name descname"><span class="pre">main</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#impresso_commons.versioning.compute_manifest.main" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="impresso_commons.versioning.compute_manifest.validate_config">
<span class="sig-prename descclassname"><span class="pre">impresso_commons.versioning.compute_manifest.</span></span><span class="sig-name descname"><span class="pre">validate_config</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Any</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#impresso_commons.versioning.compute_manifest.validate_config" title="Link to this definition"></a></dt>
<dd><p>Ensure all required configurations are defined, add any missing optional ones.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>config</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em>) – Provided configuration dict to compute the manifest.</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – Some required arguments of the configuration are missing.</p>
</dd>
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Updated config, with any mssing optional argument set to None.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>dict[str, Any]</p>
</dd>
</dl>
</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="images.html" class="btn btn-neutral float-left" title="Image handling" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Impresso - Media Monitoring of the Past - EPFL-DHLAB, UZH-ICL, UNILU-C2DH..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>